@model Pack
@{
    ViewData["Title"] = "Create Pack";
    var games = ViewBag.Games as IEnumerable<Game>;
}

<link rel="stylesheet" href="~/css/admin-modern.css" />

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="mb-4">
                <h1><i class="bi bi-plus-circle"></i> Create New Pack</h1>
                <p style="color: #718096;">Create a bundle of games with special pricing</p>
            </div>

            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle-fill"></i> @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <div class="admin-form-card">
                <form asp-action="Create" method="post">
                    @Html.AntiForgeryToken()

                    <!-- Pack Name -->
                    <div class="admin-form-group">
                        <label asp-for="PackName" class="admin-form-label">
                            <i class="bi bi-box-seam"></i> Pack Name
                        </label>
                        <input asp-for="PackName" class="admin-form-control" placeholder="Enter pack name" required />
                        <span asp-validation-for="PackName" class="text-danger"></span>
                    </div>

                    <!-- Description -->
                    <div class="admin-form-group">
                        <label asp-for="Description" class="admin-form-label">
                            <i class="bi bi-text-paragraph"></i> Description
                        </label>
                        <textarea asp-for="Description" class="admin-form-control" rows="3" placeholder="Enter pack description"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <!-- Price -->
                    <div class="admin-form-group">
                        <label asp-for="Price" class="admin-form-label">
                            <i class="bi bi-tag-fill"></i> Pack Price
                        </label>
                        <input asp-for="Price" type="number" step="0.01" class="admin-form-control" placeholder="0.00" required />
                        <span asp-validation-for="Price" class="text-danger"></span>
                    </div>

                    <!-- Image URL -->
                    <div class="admin-form-group">
                        <label asp-for="Image" class="admin-form-label">
                            <i class="bi bi-image"></i> Pack Image URL
                        </label>
                        <input asp-for="Image" class="admin-form-control" id="imageUrl" placeholder="https://example.com/image.jpg" />
                        <span asp-validation-for="Image" class="text-danger"></span>
                        
                        <!-- Image Preview -->
                        <div id="imagePreview" style="margin-top: 1rem; display: none;">
                            <img id="previewImg" src="" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 12px; object-fit: cover;" />
                        </div>
                    </div>

                    <!-- Active Status -->
                    <div class="admin-form-group">
                        <div class="form-check" style="padding-left: 0;">
                            <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                                <input asp-for="IsActive" type="checkbox" checked style="width: 20px; height: 20px; cursor: pointer;" />
                                <span style="color: #2d3748; font-weight: 600;">
                                    <i class="bi bi-check-circle"></i> Pack is Active
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Select Games -->
                    <div class="admin-form-group">
                        <label class="admin-form-label">
                            <i class="bi bi-controller"></i> Select Games for Pack
                        </label>
                        <div style="max-height: 300px; overflow-y: auto; border: 2px solid #e2e8f0; border-radius: 12px; padding: 1rem; background: #f7fafc;">
                            @if (games != null && games.Any())
                            {
                                foreach (var game in games)
                                {
                                    <div style="margin-bottom: 0.75rem;">
                                        <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer; padding: 0.5rem; border-radius: 8px; transition: background 0.2s;" class="game-checkbox-label">
                                            <input type="checkbox" name="selectedGames" value="@game.Id" style="width: 18px; height: 18px; cursor: pointer;" />
                                            <span style="color: #2d3748; font-weight: 500;">@game.GameName</span>
                                            <span style="margin-left: auto; color: #667eea; font-weight: 600;">@game.Price.ToString("C")</span>
                                        </label>
                                    </div>
                                }
                            }
                            else
                            {
                                <p style="color: #718096; text-align: center; margin: 0;">No games available</p>
                            }
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="admin-form-actions">
                        <button type="submit" class="btn-admin-primary">
                            <i class="bi bi-check-circle"></i> Create Pack
                        </button>
                        <a asp-action="Index" class="btn-admin-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Image preview
    const imageUrl = document.getElementById('imageUrl');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');

    imageUrl.addEventListener('input', function() {
        if (this.value) {
            previewImg.src = this.value;
            imagePreview.style.display = 'block';
            previewImg.onerror = function() {
                imagePreview.style.display = 'none';
            };
        } else {
            imagePreview.style.display = 'none';
        }
    });

    // Checkbox hover effect
    const labels = document.querySelectorAll('.game-checkbox-label');
    labels.forEach(label => {
        label.addEventListener('mouseenter', function() {
            this.style.background = '#edf2f7';
        });
        label.addEventListener('mouseleave', function() {
            this.style.background = 'transparent';
        });
    });
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
